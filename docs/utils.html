---

title: Utility functions


keywords: fastai
sidebar: home_sidebar

summary: "Utility functions for deepflash2"
description: "Utility functions for deepflash2"
nb_path: "nbs/06_utils.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/06_utils.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">nbdev</span> <span class="kn">import</span> <span class="o">*</span>
<span class="o">%</span><span class="k">nbdev_default_export</span> utils
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Cells will be exported to deepflash2.utils,
unless a different module is specified after an export flag: `%nbdev_export special.module`
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">nbdev_hide</span>
<span class="kn">from</span> <span class="nn">nbdev.showdoc</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">nbdev_export</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">zipfile</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">ndimage</span>
<span class="kn">from</span> <span class="nn">scipy.spatial.distance</span> <span class="kn">import</span> <span class="n">jaccard</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">entropy</span>
<span class="kn">from</span> <span class="nn">skimage.feature</span> <span class="kn">import</span> <span class="n">peak_local_max</span>
<span class="kn">from</span> <span class="nn">skimage.segmentation</span> <span class="kn">import</span> <span class="n">clear_border</span>
<span class="kn">from</span> <span class="nn">skimage.measure</span> <span class="kn">import</span> <span class="n">label</span>
<span class="kn">from</span> <span class="nn">skimage.segmentation</span> <span class="kn">import</span> <span class="n">relabel_sequential</span><span class="p">,</span> <span class="n">watershed</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">linear_sum_assignment</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Archive-Extraction">Archive Extraction<a class="anchor-link" href="#Archive-Extraction"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">nbdev_export</span>
<span class="k">def</span> <span class="nf">unzip</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">zip_file</span><span class="p">):</span>
    <span class="s2">&quot;Unzip and structure archive&quot;</span>
    <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">zip_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zf</span><span class="p">:</span>
        <span class="n">f_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">zf</span><span class="o">.</span><span class="n">namelist</span><span class="p">()</span> <span class="k">if</span> <span class="s1">&#39;__MACOSX&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">x</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">x</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)]</span>
        <span class="n">new_root</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">.</span><span class="n">parts</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">f_names</span><span class="p">])</span><span class="o">-</span><span class="mi">2</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">f_names</span><span class="p">:</span>
            <span class="n">f_path</span> <span class="o">=</span> <span class="n">path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="o">*</span><span class="n">Path</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="n">new_root</span><span class="p">:])</span>
            <span class="n">f_path</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">zf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="n">f_path</span><span class="o">.</span><span class="n">write_bytes</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Ensembling">Ensembling<a class="anchor-link" href="#Ensembling"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">nbdev_export</span>
<span class="k">def</span> <span class="nf">ensemble_results</span><span class="p">(</span><span class="n">res_dict</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">std</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="s2">&quot;Combines single model predictions.&quot;</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="mi">2</span> <span class="k">if</span> <span class="n">std</span> <span class="k">else</span> <span class="mi">0</span>
    <span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">res_dict</span><span class="p">[(</span><span class="n">mod</span><span class="p">,</span> <span class="n">f</span><span class="p">)][</span><span class="n">idx</span><span class="p">])</span> <span class="k">for</span> <span class="n">mod</span><span class="p">,</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">res_dict</span> <span class="k">if</span> <span class="n">f</span><span class="o">==</span><span class="n">file</span><span class="p">]</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">std</span><span class="p">:</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> 
    <span class="k">return</span> <span class="n">a</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">nbdev_export</span>
<span class="k">def</span> <span class="nf">plot_results</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="s2">&quot;Plot images, (masks), predictions and uncertainties side-by-side.&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span><span class="o">==</span><span class="mi">4</span><span class="p">:</span>
        <span class="n">img</span><span class="p">,</span> <span class="n">msk</span><span class="p">,</span> <span class="n">pred</span><span class="p">,</span> <span class="n">pred_std</span> <span class="o">=</span> <span class="n">args</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
        <span class="n">img</span><span class="p">,</span> <span class="n">pred</span><span class="p">,</span> <span class="n">pred_std</span> <span class="o">=</span> <span class="n">args</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">),</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="c1">#One channel fix</span>
    <span class="k">if</span> <span class="n">img</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> 
        <span class="n">img</span><span class="o">=</span><span class="n">img</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;File </span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">file</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span><span class="o">==</span><span class="mi">4</span><span class="p">:</span> 
        <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">msk</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Target&#39;</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">pred</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Prediction </span><span class="se">\n</span><span class="s1"> IoU: </span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">iou</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">pred_std</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Uncertainty </span><span class="se">\n</span><span class="s1"> Entropy: </span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">entropy</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span> 
        <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">pred</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Prediction&#39;</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">pred_std</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Uncertainty </span><span class="se">\n</span><span class="s1"> Entropy: </span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">entropy</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Pixelwise-Analysis">Pixelwise Analysis<a class="anchor-link" href="#Pixelwise-Analysis"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">nbdev_hide</span>
<span class="c1"># Generate an initial random image and mask with two circles</span>
<span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">indices</span><span class="p">((</span><span class="mi">80</span><span class="p">,</span> <span class="mi">80</span><span class="p">))</span>
<span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">44</span><span class="p">,</span> <span class="mi">52</span>
<span class="n">r1</span><span class="p">,</span> <span class="n">r2</span> <span class="o">=</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">20</span>
<span class="n">mask_circle1</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">y1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">&lt;</span> <span class="n">r1</span> <span class="o">**</span> <span class="mi">2</span>
<span class="n">mask_circle2</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">x2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">y2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">&lt;</span> <span class="n">r2</span> <span class="o">**</span> <span class="mi">2</span>
<span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">mask_circle1</span><span class="p">,</span> <span class="n">mask_circle2</span><span class="p">)</span>
<span class="n">empty_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Mask&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">empty_mask</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Empty Mask&#39;</span><span class="p">);</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
"
>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">nbdev_export</span>
<span class="k">def</span> <span class="nf">iou</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">threshold</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Computes the Intersection-Over-Union metric.&#39;&#39;&#39;</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">threshold</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">threshold</span>
    <span class="n">overlap</span> <span class="o">=</span> <span class="n">a</span><span class="o">*</span><span class="n">b</span> <span class="c1"># Logical AND</span>
    <span class="n">union</span> <span class="o">=</span> <span class="n">a</span><span class="o">+</span><span class="n">b</span> <span class="c1"># Logical OR</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">overlap</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">union</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="n">iou</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">mask</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">iou</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">empty_mask</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="ROI-wise-Analysis">ROI-wise Analysis<a class="anchor-link" href="#ROI-wise-Analysis"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">nbdev_export</span>
<span class="k">def</span> <span class="nf">label_mask</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">min_pixel</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">do_watershed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exclude_border</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Analyze regions and return labels&#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">mask</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># apply threshold to mask</span>
    <span class="c1"># bw = closing(mask &gt; threshold, square(2))</span>
    <span class="n">bw</span> <span class="o">=</span> <span class="p">(</span><span class="n">mask</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

    <span class="c1"># label image regions</span>
    <span class="n">label_image</span> <span class="o">=</span> <span class="n">label</span><span class="p">(</span><span class="n">bw</span><span class="p">,</span> <span class="n">connectivity</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># Falk p.13, 8-“connectivity”.</span>

    <span class="c1"># Watershed: Separates objects in image by generate the markers</span>
    <span class="c1"># as local maxima of the distance to the background</span>
    <span class="k">if</span> <span class="n">do_watershed</span><span class="p">:</span>
        <span class="n">distance</span> <span class="o">=</span> <span class="n">ndimage</span><span class="o">.</span><span class="n">distance_transform_edt</span><span class="p">(</span><span class="n">bw</span><span class="p">)</span>
        <span class="c1"># Minimum number of pixels separating peaks in a region of `2 * min_distance + 1`</span>
        <span class="c1"># (i.e. peaks are separated by at least `min_distance`)</span>
        <span class="n">min_distance</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">min_pixel</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)))</span>
        <span class="n">local_maxi</span> <span class="o">=</span> <span class="n">peak_local_max</span><span class="p">(</span><span class="n">distance</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">exclude_border</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                    <span class="n">min_distance</span><span class="o">=</span><span class="n">min_distance</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">label_image</span><span class="p">)</span>
        <span class="n">markers</span> <span class="o">=</span> <span class="n">label</span><span class="p">(</span><span class="n">local_maxi</span><span class="p">)</span>
        <span class="n">label_image</span> <span class="o">=</span> <span class="n">watershed</span><span class="p">(</span><span class="o">-</span><span class="n">distance</span><span class="p">,</span> <span class="n">markers</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">bw</span><span class="p">)</span>

    <span class="c1"># remove artifacts connected to image border</span>
    <span class="k">if</span> <span class="n">exclude_border</span><span class="p">:</span>
        <span class="n">label_image</span> <span class="o">=</span> <span class="n">clear_border</span><span class="p">(</span><span class="n">label_image</span><span class="p">)</span>

    <span class="c1"># remove areas &lt; min pixel</span>
    <span class="n">unique</span><span class="p">,</span> <span class="n">counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">label_image</span><span class="p">,</span> <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">label_image</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">label_image</span><span class="p">,</span> <span class="n">unique</span><span class="p">[</span><span class="n">counts</span><span class="o">&lt;</span><span class="n">min_pixel</span><span class="p">])]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># re-label image</span>
    <span class="n">label_image</span><span class="p">,</span> <span class="n">_</span> <span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">relabel_sequential</span><span class="p">(</span><span class="n">label_image</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">label_image</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst_lbl_a</span> <span class="o">=</span> <span class="n">label_mask</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">min_pixel</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">tst_lbl_a</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">tst_lbl_a</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">tst_lbl_a</span><span class="p">);</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
"
>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst_lbl_b</span> <span class="o">=</span> <span class="n">label_mask</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">min_pixel</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">tst_lbl_b</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">tst_lbl_b</span><span class="p">);</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
"
>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">nbdev_export</span>
<span class="k">def</span> <span class="nf">get_candidates</span><span class="p">(</span><span class="n">labels_a</span><span class="p">,</span> <span class="n">labels_b</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Get candiate masks for ROI-wise analysis&#39;&#39;&#39;</span>

    <span class="n">label_stack</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">((</span><span class="n">labels_a</span><span class="p">,</span> <span class="n">labels_b</span><span class="p">))</span>
    <span class="n">cadidates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">label_stack</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">label_stack</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="c1"># Remove Zero Entries</span>
    <span class="n">cadidates</span> <span class="o">=</span> <span class="n">cadidates</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">cadidates</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span><span class="p">(</span><span class="n">cadidates</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">nbdev_export</span>
<span class="k">def</span> <span class="nf">iou_mapping</span><span class="p">(</span><span class="n">labels_a</span><span class="p">,</span> <span class="n">labels_b</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Compare masks using ROI-wise analysis&#39;&#39;&#39;</span>

    <span class="n">candidates</span> <span class="o">=</span> <span class="n">get_candidates</span><span class="p">(</span><span class="n">labels_a</span><span class="p">,</span> <span class="n">labels_b</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">candidates</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># create a similarity matrix</span>
        <span class="n">dim_a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">candidates</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="mi">1</span>
        <span class="n">dim_b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">candidates</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="mi">1</span>
        <span class="n">similarity_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">dim_a</span><span class="p">,</span> <span class="n">dim_b</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="ow">in</span> <span class="n">candidates</span><span class="p">:</span>
            <span class="n">roi_a</span> <span class="o">=</span> <span class="p">(</span><span class="n">labels_a</span> <span class="o">==</span> <span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
            <span class="n">roi_b</span> <span class="o">=</span> <span class="p">(</span><span class="n">labels_b</span> <span class="o">==</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
            <span class="n">similarity_matrix</span><span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="n">jaccard</span><span class="p">(</span><span class="n">roi_a</span><span class="p">,</span> <span class="n">roi_b</span><span class="p">)</span>

        <span class="n">row_ind</span><span class="p">,</span> <span class="n">col_ind</span> <span class="o">=</span> <span class="n">linear_sum_assignment</span><span class="p">(</span><span class="o">-</span><span class="n">similarity_matrix</span><span class="p">)</span>

        <span class="k">return</span><span class="p">(</span><span class="n">similarity_matrix</span><span class="p">[</span><span class="n">row_ind</span><span class="p">,</span><span class="n">col_ind</span><span class="p">],</span>
               <span class="n">row_ind</span><span class="p">,</span> <span class="n">col_ind</span><span class="p">,</span>
               <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">labels_a</span><span class="p">),</span>
               <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">labels_b</span><span class="p">)</span>
               <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span><span class="p">([],</span>
               <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
               <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">labels_a</span><span class="p">),</span>
               <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">labels_b</span><span class="p">)</span>
               <span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="n">iou_mapping</span><span class="p">(</span><span class="n">tst_lbl_a</span><span class="p">,</span> <span class="n">tst_lbl_a</span><span class="p">),</span> <span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">iou_mapping</span><span class="p">(</span><span class="n">tst_lbl_a</span><span class="p">,</span> <span class="n">tst_lbl_b</span><span class="p">),</span> <span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">nbdev_export</span>
<span class="k">def</span> <span class="nf">calculate_roi_measures</span><span class="p">(</span><span class="o">*</span><span class="n">masks</span><span class="p">,</span> <span class="n">iou_threshold</span><span class="o">=.</span><span class="mi">5</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="s2">&quot;Calculates precision, recall, and f1_score on ROI-level&quot;</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">label_mask</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">masks</span><span class="p">]</span>
    <span class="n">matches_iou</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span><span class="n">_</span><span class="p">,</span> <span class="n">count_a</span><span class="p">,</span> <span class="n">count_b</span> <span class="o">=</span> <span class="n">iou_mapping</span><span class="p">(</span><span class="o">*</span><span class="n">labels</span><span class="p">)</span>
    <span class="n">matches</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">matches_iou</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">iou_threshold</span><span class="p">)</span>
    <span class="n">precision</span> <span class="o">=</span>  <span class="n">matches</span><span class="o">/</span><span class="n">count_a</span>
    <span class="n">recall</span> <span class="o">=</span> <span class="n">matches</span><span class="o">/</span><span class="n">count_b</span>
    <span class="n">f1_score</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">precision</span> <span class="o">*</span> <span class="n">recall</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">precision</span> <span class="o">+</span> <span class="n">recall</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">recall</span><span class="p">,</span> <span class="n">precision</span><span class="p">,</span> <span class="n">f1_score</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="n">calculate_roi_measures</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">mask</span><span class="p">),</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">))</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">calculate_roi_measures</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">min_pixel</span><span class="o">=</span><span class="mi">150</span><span class="p">),</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Miscellaneous">Miscellaneous<a class="anchor-link" href="#Miscellaneous"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">nbdev_export</span>
<span class="k">def</span> <span class="nf">calc_iterations</span><span class="p">(</span><span class="n">n_slices</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">n_splits</span><span class="p">,</span> <span class="n">n_iter</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
    <span class="s2">&quot;Calculate the number of required epochs for &#39;n_iter&#39; iterations.&quot;</span>
    <span class="k">if</span> <span class="n">n_splits</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">n_slices</span><span class="o">*</span><span class="mf">0.75</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">n_slices</span><span class="o">*</span><span class="p">((</span><span class="n">n_splits</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">n_splits</span><span class="p">)</span>
    <span class="n">iter_per_epoch</span> <span class="o">=</span> <span class="n">n</span><span class="o">/</span><span class="n">batch_size</span>
    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">n_iter</span><span class="o">/</span><span class="n">iter_per_epoch</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">nbdev_hide</span>
<span class="kn">from</span> <span class="nn">nbdev.export</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">notebook2script</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Converted 00_learner.ipynb.
Converted 01_models.ipynb.
Converted 02_data.ipynb.
Converted 03_metrics.ipynb.
Converted 04_callbacks.ipynb.
Converted 05_losses.ipynb.
Converted 06_utils.ipynb.
Converted add_information.ipynb.
Converted gt_estimation.ipynb.
Converted index.ipynb.
Converted model_library.ipynb.
Converted predict.ipynb.
Converted train.ipynb.
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

